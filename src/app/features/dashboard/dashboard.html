<div class="main-content">
  <div class="dashboard">
    <div class="dashboard-loading-overlay" *ngIf="isLoading()">
      <mat-progress-bar mode="indeterminate" color="accent" class="loading-bar"></mat-progress-bar>
      <p>Daten werden geladen...</p>
      <span class="loading-subtext">Bitte warten Sie einen Moment</span>
    </div>

    <ng-container *ngIf="!isLoading()">
      <!-- Empty State -->
      <div class="no-data" *ngIf="(data()?.uploads?.length || 0) === 0 && (mitternachtsstatistikData()?.uploads?.length || 0) === 0">
        <mat-icon class="no-data-icon">insert_chart_outlined</mat-icon>
        <h3>Noch keine Daten vorhanden</h3>
        <p>Laden Sie Excel-Dateien hoch, um Charts und Statistiken zu visualisieren.</p>
        <a mat-raised-button color="primary" routerLink="/upload">
          <mat-icon>upload_file</mat-icon>
          Dateien hochladen
        </a>
      </div>

      <!-- Reset Button -->
      <div class="reset-section" *ngIf="(data()?.uploads?.length || 0) > 0 || (mitternachtsstatistikData()?.uploads?.length || 0) > 0">
        <button mat-raised-button color="warn" (click)="openResetDialog()" class="reset-button">
          <mat-icon>delete_forever</mat-icon>
          Alle Daten zurücksetzen
        </button>
      </div>

      <!-- Mitternachtsstatistik Charts Section -->
      <section 
        id="mitternachtsstatistik"
        class="mitternachtsstatistik-charts-section" 
        [class.highlighted]="highlightedSchemaId() === 'mitternachtsstatistik'"
        *ngIf="mitternachtsstatistikData() && mitternachtsstatistikData()!.uploads.length > 0">
        <div class="schema-header">
          <h2 class="schema-title">Mitternachtsstatistik</h2>
          <button 
            mat-stroked-button 
            color="warn" 
            (click)="openDeleteSchemaDialog('mitternachtsstatistik', 'Mitternachtsstatistik')"
            class="delete-schema-button"
            matTooltip="Alle Daten für dieses Schema zurücksetzen">
            <mat-icon>delete</mat-icon>
            <span>Daten zurücksetzen</span>
          </button>
        </div>
        <app-mitternachtsstatistik-charts 
          [mitternachtsstatistikData]="mitternachtsstatistikData()">
        </app-mitternachtsstatistik-charts>
      </section>

      <!-- Patienten/Pflegekraft Charts Section -->
      <section 
        class="pp-charts-section"
        *ngIf="hasPatientenPflegekraftData()">
        <app-patienten-pflegekraft-charts></app-patienten-pflegekraft-charts>
      </section>

      <!-- MiNa/MiTa Charts Section -->
      <section 
        id="ppugv_bestaende"
        class="mina-mita-charts-section" 
        [class.highlighted]="highlightedSchemaId() === 'ppugv_bestaende'"
        *ngIf="hasMinaMitaData()">
        <div class="schema-header">
          <h2 class="schema-title">CO PPUGV MiNa/MiTa-Bestände</h2>
          <button 
            mat-stroked-button 
            color="warn" 
            (click)="openDeleteSchemaDialog('ppugv_bestaende', 'CO PPUGV MiNa/MiTa-Bestände')"
            class="delete-schema-button"
            matTooltip="Alle Daten für dieses Schema zurücksetzen">
            <mat-icon>delete</mat-icon>
            <span>Daten zurücksetzen</span>
          </button>
        </div>
        <app-mina-mita-charts 
          [uploads]="data()?.uploads || []">
        </app-mina-mita-charts>
      </section>

      <!-- CO Charts Section -->
      <section 
        id="co_entlass_aufnahmezeiten"
        class="co-charts-section" 
        [class.highlighted]="highlightedSchemaId() === 'co_entlass_aufnahmezeiten'"
        *ngIf="hasCOData()">
        <div class="schema-header">
          <h2 class="schema-title">CO Entlass-/Aufnahmezeiten</h2>
          <button 
            mat-stroked-button 
            color="warn" 
            (click)="openDeleteSchemaDialog('co_entlass_aufnahmezeiten', 'CO Entlass-/Aufnahmezeiten')"
            class="delete-schema-button"
            matTooltip="Alle Daten für dieses Schema zurücksetzen">
            <mat-icon>delete</mat-icon>
            <span>Daten zurücksetzen</span>
          </button>
        </div>
        <app-co-charts 
          [uploads]="data()?.uploads || []"
          [statistics]="statistics()"
          [schemaId]="'co_entlass_aufnahmezeiten'"
          [selectedYear]="globalSelectedYear()">
        </app-co-charts>
      </section>

      <!-- Pflegestufenstatistik Charts Section -->
      <section 
        id="pflegestufenstatistik"
        class="pflegestufenstatistik-charts-section" 
        [class.highlighted]="highlightedSchemaId() === 'pflegestufenstatistik'"
        *ngIf="hasPflegestufenData()">
        <div class="schema-header">
          <h2 class="schema-title">Pflegestufenstatistik</h2>
          <button 
            mat-stroked-button 
            color="warn" 
            (click)="openDeleteSchemaDialog('pflegestufenstatistik', 'Pflegestufenstatistik')"
            class="delete-schema-button"
            matTooltip="Alle Daten für dieses Schema zurücksetzen">
            <mat-icon>delete</mat-icon>
            <span>Daten zurücksetzen</span>
          </button>
        </div>
        <app-pflegestufenstatistik-charts 
          [uploads]="data()?.uploads || []">
        </app-pflegestufenstatistik-charts>
      </section>

      <!-- Salden Zeitkonten Charts Section -->
      <section 
        id="salden_zeitkonten"
        class="salden-zeitkonten-charts-section" 
        [class.highlighted]="highlightedSchemaId() === 'salden_zeitkonten'"
        *ngIf="hasSaldenData()">
        <div class="schema-header">
          <h2 class="schema-title">Salden Zeitkonten u Urlaub</h2>
          <button 
            mat-stroked-button 
            color="warn" 
            (click)="openDeleteSchemaDialog('salden_zeitkonten', 'Salden Zeitkonten u Urlaub')"
            class="delete-schema-button"
            matTooltip="Alle Daten für dieses Schema zurücksetzen">
            <mat-icon>delete</mat-icon>
            <span>Daten zurücksetzen</span>
          </button>
        </div>
        <app-salden-zeitkonten-charts 
          [uploads]="data()?.uploads || []">
        </app-salden-zeitkonten-charts>
      </section>

      <!-- Mitteilungen Betten Charts Section -->
      <section 
        id="mitteilungen_betten"
        class="mitteilungen-betten-charts-section" 
        [class.highlighted]="highlightedSchemaId() === 'mitteilungen_betten'"
        *ngIf="hasMitteilungenBettenData()">
        <div class="schema-header">
          <h2 class="schema-title">Aufgestellte Betten</h2>
          <button 
            mat-stroked-button 
            color="warn" 
            (click)="openDeleteSchemaDialog('mitteilungen_betten', 'Aufgestellte Betten')"
            class="delete-schema-button"
            matTooltip="Alle Daten für dieses Schema zurücksetzen">
            <mat-icon>delete</mat-icon>
            <span>Daten zurücksetzen</span>
          </button>
        </div>
        <app-mitteilungen-betten-charts 
          [data]="data()"
          [selectedYearInput]="globalSelectedYear()">
        </app-mitteilungen-betten-charts>
      </section>

      <!-- Ausfallstatistik Charts Section -->
      <section 
        id="ausfallstatistik"
        class="ausfallstatistik-charts-section" 
        [class.highlighted]="highlightedSchemaId() === 'ausfallstatistik'"
        *ngIf="hasAusfallstatistikData()">
        <div class="schema-header">
          <h2 class="schema-title">Ausfallstatistik</h2>
          <button 
            mat-stroked-button 
            color="warn" 
            (click)="openDeleteSchemaDialog('ausfallstatistik', 'Ausfallstatistik')"
            class="delete-schema-button"
            matTooltip="Alle Daten für dieses Schema zurücksetzen">
            <mat-icon>delete</mat-icon>
            <span>Daten zurücksetzen</span>
          </button>
        </div>
        <app-ausfallstatistik-charts 
          [uploads]="data()?.uploads || []"
          [selectedYear]="globalSelectedYear()">
        </app-ausfallstatistik-charts>
      </section>
    </ng-container>
  </div>
</div>

<div class="main-content">
  <div class="upload">
    <h2>Datei Upload</h2>
    <p class="upload-subtitle">Laden Sie Dateien hoch und extrahieren Sie Daten basierend auf vordefinierten Schemata</p>

    <div class="schema-selector-row">
      <mat-form-field appearance="outline">
        <mat-label>W√§hlen Sie ein Schema</mat-label>
        <mat-select [ngModel]="selectedSchemaId()" (ngModelChange)="onSchemaChange($event)">
          <mat-option *ngFor="let s of filteredSchemas" [value]="s.id">{{ s.name }}</mat-option>
        </mat-select>
      </mat-form-field>
      
      <button mat-icon-button 
              *ngIf="selectedSchemaId()" 
              (click)="openSchemaInfoDialog()"
              matTooltip="Schema-Informationen anzeigen"
              class="info-button">
        <mat-icon>info</mat-icon>
      </button>
    </div>

    <div class="file-upload-section"
         (click)="triggerFileSelect()"
         (dragover)="onDragOver($event)"
         (dragleave)="onDragLeave($event)"
         (drop)="onDrop($event)"
         [class.drag-over]="dragOver()">
      <input #fileInput type="file" multiple (change)="onFileChange($event)" [accept]="getAcceptedFileTypes()" style="display: none;" />
      <div class="upload-placeholder">
        <div class="upload-icon">üìä</div>
        <h3>{{ dragOver() ? 'Dateien hier ablegen' : 'Klicken Sie hier, um Dateien auszuw√§hlen' }}</h3>
        <p>{{ dragOver() ? 'Loslassen zum Hochladen' : 'Oder ziehen Sie Dateien hierher' }}</p>
        <p class="file-types">{{ getSupportedFileTypesText() }}</p>
      </div>
      <div class="upload-actions">
        <button mat-raised-button color="primary" (click)="$event.stopPropagation(); doUpload()"
                [disabled]="uploading() || !selectedSchemaId() || files().length===0">
          <mat-spinner *ngIf="uploading()" diameter="20" class="upload-spinner"></mat-spinner>
          <mat-icon *ngIf="!uploading()">cloud_upload</mat-icon>
          {{ uploading() ? 'Wird hochgeladen...' : 'Dateien hochladen' }}
        </button>
        <button mat-stroked-button (click)="$event.stopPropagation(); clearFiles()" [disabled]="files().length===0">
          <mat-icon>clear</mat-icon>
          Zur√ºcksetzen
        </button>
      </div>
    </div>

    <mat-list *ngIf="files().length" class="file-list">
      <h3>Ausgew√§hlte Dateien:</h3>
      <mat-list-item *ngFor="let f of files(); let i = index">
        <div class="file-item">
          <mat-icon>description</mat-icon>
          <div class="file-info">
            <span class="file-name">{{ f.name }}</span>
            <span class="file-size">({{ (f.size / 1024) | number:'1.0-1' }} KB)</span>
          </div>
          <button mat-icon-button 
                  (click)="removeFile(i)" 
                  class="remove-file-button"
                  matTooltip="Datei entfernen"
                  color="warn">
            <mat-icon>close</mat-icon>
          </button>
        </div>
      </mat-list-item>
    </mat-list>

    <div class="upload-loading-overlay" *ngIf="uploading()">
      <mat-progress-spinner mode="indeterminate" diameter="64"></mat-progress-spinner>
      <p>Upload l√§uft noch. Einen Moment bitte‚Ä¶</p>
    </div>
  </div>
</div>